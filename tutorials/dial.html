
<!-- dial.html -->

<style>
#video-out {
    position: relative;
}
#my-number,#number,button {
    display:none;
    position: fixed;
    left: 10px;
    color: #fff;
    z-index: 100;
}
</style>
<body>
<!-- Video Output Zone -->
<input id="number" /><button onclick="call()">call</button>
 <div id="my-number">Ожидаем врача</div>
<div id="video-out">
   
</div>
</body>
<script src="../js/webrtc-v2.js"></script>

<script>
    var session = null;
    const number = (''+Math.random()*100000).split('.')[0];
    console.log(number);
    document.getElementById('my-number').innerHTML = number;
    const urlParams = new URLSearchParams(window.location.search);

// Retrieve the 'id' parameter from the URL
const id = urlParams.get('id');
 //   const pubkey = 'pub-c-9d2c07d1-d4b6-403b-b0c3-def8a944666e';
 //   const subkey = 'sub-c-f5659372-2568-4f19-bc2a-be6a5dbe4d65';
    var phone = PHONE({
        number        : number,
        publish_key   : 'pub-c-9d2c07d1-d4b6-403b-b0c3-def8a944666e',
        subscribe_key : 'sub-c-f5659372-2568-4f19-bc2a-be6a5dbe4d65',
        media         : { audio : true, video : true },
        ssl           : true
    });

    phone.ready(function(){
        console.log('Phone is ready');
    });

    phone.camera.ready(function(video){
        console.log('Camera is ready', video);
        phone.$('video-out').append(video); //first attempt, all I get is an empty video tag
        call(id);
    })

    // When Call Comes In or is to be Connected
    phone.receive(function(session){
        console.log('Receiving call from Friend!');
        session.connected(function(session){
            // Display Your Friend's Live Video
            console.log("Showing your friend's video stream");

               document.querySelector('body').innerHTML='';
            document.querySelector('body').appendChild(session.video);
        });
    });

    function call(id) {
         if(id!=undefined)  { session = phone.dial(id); console.log('calling ' + id); } else {
        var callee = document.getElementById('number').value;
        console.log('calling ' + callee);
        session = phone.dial(callee);
        }
    }
</script>
