<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dial Page</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #container {
            display: flex;
            flex-direction: column;
            height: 90vh; /* Set to 90% of viewport height */
            max-height: 600px; /* Maximum height to prevent excessive scrolling */
        }
        #video-out {
            width: 100%;
            aspect-ratio: 16 / 9;
            object-fit: cover;
        }
        #my-number {
            text-align: center;
            font-size: 24px;
            margin-top: 20px;
        }
        #controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="row">
            <div class="col">
                <div id="video-out"></div>
            </div>
        </div>
             <div class="row">
            <div class="col">
                <div id="video-in">Ожидаем</div>
            </div>
        </div>
                               
       
    </div>

<script src="../js/webrtc-v2.js"></script>

<script>
    var session = null;
    const number = (''+Math.random()*100000).split('.')[0];
    console.log(number);
    document.getElementById('my-number').innerHTML = number;
    const urlParams = new URLSearchParams(window.location.search);

// Retrieve the 'id' parameter from the URL
const id = urlParams.get('id');
 //   const pubkey = 'pub-c-9d2c07d1-d4b6-403b-b0c3-def8a944666e';
 //   const subkey = 'sub-c-f5659372-2568-4f19-bc2a-be6a5dbe4d65';
    var phone = PHONE({
        number        : number,
        publish_key   : 'pub-c-9d2c07d1-d4b6-403b-b0c3-def8a944666e',
        subscribe_key : 'sub-c-f5659372-2568-4f19-bc2a-be6a5dbe4d65',
        media         : { audio : true, video : true },
        ssl           : true
    });

    phone.ready(function(){
        console.log('Phone is ready');
    });

    phone.camera.ready(function(video){
        console.log('Camera is ready', video);
             document.querySelector('#video-out').innerHTML='';
        document.querySelector('#video-out').appendChild(video); //first attempt, all I get is an empty video tag
        call(id);
    })

    // When Call Comes In or is to be Connected
    phone.receive(function(session){
        console.log('Receiving call from Friend!');
        session.connected(function(session){
            // Display Your Friend's Live Video
            console.log("Showing your friend's video stream");

             //  document.querySelector('body').innerHTML='';
            document.querySelector('#video-in').appendChild(session.video);
        });
    });

    function call(id) {
         if(id!=undefined)  { session = phone.dial(id); console.log('calling ' + id); } else {
        var callee = document.getElementById('number').value;
        console.log('calling ' + callee);
        session = phone.dial(callee);
        }
    }
</script>
